<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>南京网络赛 A | zzpw's blog</title><meta name="keywords" content="思维,线段树"><meta name="author" content="zzpw"><meta name="copyright" content="zzpw"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="1500ms 524288K  The beautiful values of the palaceHere is a square matrix of $n\times n$, each lattice has its value ($n$ must be odd), and the center value is $n\times n$ . Its spiral decline along">
<meta property="og:type" content="article">
<meta property="og:title" content="南京网络赛 A">
<meta property="og:url" content="http://zzpw.github.io/2019/09/02/%E5%8D%97%E4%BA%AC%E7%BD%91%E7%BB%9C%E8%B5%9B-A/index.html">
<meta property="og:site_name" content="zzpw&#39;s blog">
<meta property="og:description" content="1500ms 524288K  The beautiful values of the palaceHere is a square matrix of $n\times n$, each lattice has its value ($n$ must be odd), and the center value is $n\times n$ . Its spiral decline along">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wallpapershome.com/images/pages/pic_h/16580.jpg">
<meta property="article:published_time" content="2019-09-02T06:42:00.000Z">
<meta property="article:modified_time" content="2020-12-24T09:46:41.507Z">
<meta property="article:author" content="zzpw">
<meta property="article:tag" content="思维">
<meta property="article:tag" content="线段树">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wallpapershome.com/images/pages/pic_h/16580.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://zzpw.github.io/2019/09/02/%E5%8D%97%E4%BA%AC%E7%BD%91%E7%BB%9C%E8%B5%9B-A/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-12-24 17:46:41'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/zzpw.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fas fa-comment"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page" href="/emotion/"><i class="fa-fw fas fa-cubes"></i><span> 心情</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://wallpapershome.com/images/pages/pic_h/16580.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">zzpw's blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fas fa-comment"></i><span> 留言</span></a></div><div class="menus_item"><a class="site-page" href="/emotion/"><i class="fa-fw fas fa-cubes"></i><span> 心情</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">南京网络赛 A</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-09-02T06:42:00.000Z" title="发表于 2019-09-02 14:42:00">2019-09-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-12-24T09:46:41.507Z" title="更新于 2020-12-24 17:46:41">2020-12-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ACM/">ACM</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>11分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><ul>
<li>1500ms</li>
<li>524288K</li>
</ul>
<h3 id="The-beautiful-values-of-the-palace"><a href="#The-beautiful-values-of-the-palace" class="headerlink" title="The beautiful values of the palace"></a>The beautiful values of the palace</h3><p>Here is a square matrix of $n\times n$, each lattice has its value ($n$ must be odd), and the center value is $n\times n$ . Its spiral decline along the center of the square matrix (the way of spiral decline is shown in the following figure:)</p>
<p><img src="https://res.jisuanke.com/img/upload/20190826/3b1ac98800e8ff9958638769f0ea80956b2c552f.png" alt="img"></p>
<p><img src="https://res.jisuanke.com/img/upload/20190826/e188ba2f470e2afbf1d21ac4d1887e2f225dd40b.png" alt="img"></p>
<a id="more"></a>
<p><strong>The grid in the lower left corner is (1,1) and the grid in the upper right corner is (n , n)</strong></p>
<p>Now I can choose $m$ squares to build palaces, The beauty of each palace is equal to the digital sum of the value of the land which it is located. Such as (the land value is $123213$,the beautiful values of the palace located on it is $1+2+3+2+1+3=12$) ($666$ -&gt; $18$) ($456$ -&gt;$15$)</p>
<p>Next, we ask $p$ times to the sum of the beautiful values of the palace in the matrix where the lower left grid($x_1,y_1$), the upper right square ($x_2,y_2$).</p>
<h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>The first line has only one number $T$ .Representing $T$-group of test data ($T\le 5$)</p>
<p>The next line is three number: $n\ m\ p$</p>
<p>The $m$ lines follow, each line contains two integers the square of the palace ($x, y$)</p>
<p>The $p$ lines follow, each line contains four integers : the lower left grid ($x_1,y_1$) the upper right square ($x_2,y_2$)</p>
<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>Next, $p_1+p_2…+p_T$ lines: Represent the answer in turn($n \le 10^6$)($m , p \le 10^5$)</p>
<h3 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">3 4 4</span><br><span class="line">1 1</span><br><span class="line">2 2</span><br><span class="line">3 3</span><br><span class="line">2 3</span><br><span class="line">1 1 1 1</span><br><span class="line">2 2 3 3</span><br><span class="line">1 1 3 3</span><br><span class="line">1 2 2 3</span><br></pre></td></tr></table></figure>
<h3 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">18</span><br><span class="line">23</span><br><span class="line">17</span><br></pre></td></tr></table></figure>
<h3 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h3><p>给定一个$n\times n$ 的矩阵，构造方法：从右上角顺时针旋转形成。然后给出 $m$ 个点，只有这 $m$ 个点的值有效，别的全部变为 $0$，然后有 $q$ 个查询，每次查询一个区域，求这个区域内的格子的权值和，一个格子的权值定义为这个格子数值的数位和。</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>考虑用线段树离线处理（其实用主席树在线处理可能更好）。</p>
<p>按照 $x$ 轴去建立一棵线段树，线段树存的值是 $x$ 坐标在某一区间内的点的权值之和。我们先把所有的点，即包括有效点和查询点共 $m + 2q$ 个点，放在一个数组里，然后按照 $y$ 轴从小到大排序， $y$ 相同则按 $tag$ 排序。注意，点存入该数组时要加标记，要出入的点（即那 $m$ 个）$tag$ 为 $1$，查询的左下角的点 $tag$ 为 $0$，查询的右上角的点 $tag$ 为 $2$ ，为什么要这么标记呢？下面解释。</p>
<p>首先，我们顺序扫描这个数组</p>
<ul>
<li>碰到 $tag$ 为 $1$ 的点，则插入线段树。</li>
<li>$tag$ 为 $0$ 的点，则说明它是某一个查询的左下角的点，此时需要查询一次他和其对应的右上角点所夹的 $x$ 轴区间的值，存到ans数组里去，即 $ans[p[i].id] = query(l_1, l_2)$，$l_1$ 是当前点的 $x$ 坐标，$l_2$ 是其对应右上角点的 $x$ 坐标。</li>
<li>$tag$ 为 2 的点，则说明它是某个查询的右上角的点，此时也要进行一次查询，查询的区间同上，此时更新答案 $ans[p[i].id] = query(l_1, l_2) - ans[p[i].id]$ </li>
</ul>
<p><img src="/2019/09/02/%E5%8D%97%E4%BA%AC%E7%BD%91%E7%BB%9C%E8%B5%9B-A/1.jpg" alt></p>
<p>用这幅图来说明就是，用大的矩形减去那个小的矩形，即为答案。那为什么之前的 $tag$ 要那么安排呢？这里有一个细节要注意，我们减的时候，不能把左下角那个点所在的那一行也给减掉啊，所以在排序时，<strong>当 $y$ 相同时</strong>，左下角的点必须排在要插入的点之前，同理，右上角的点必须排在要插入的点之后。</p>
<p>至于如何 $O(1)$ 获取构造的矩阵中某个点的值，有公式，网上也有资料，大家可以自己推一下。</p>
<p>类似的思路，用主席树也可以很快的写出来。</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> x, y, x1;</span><br><span class="line">  <span class="keyword">int</span> id, tag;</span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> node&amp; t) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (y == t.y) &#123;</span><br><span class="line">      <span class="keyword">return</span> tag &lt; t.tag;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> y &lt; t.y;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; p[maxn];</span><br><span class="line"></span><br><span class="line">ll tree[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line">ll ans[maxn];</span><br><span class="line"><span class="keyword">int</span> n, m, q;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> rt, <span class="keyword">int</span> c, ll val)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">    tree[rt] += val;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (c &lt;= m) &#123;</span><br><span class="line">    update(l, m, rt &lt;&lt; <span class="number">1</span>, c, val);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    update(m + <span class="number">1</span>, r, rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, c, val);</span><br><span class="line">  &#125;</span><br><span class="line">  tree[rt] = tree[rt &lt;&lt; <span class="number">1</span>] + tree[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">query</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> tl, <span class="keyword">int</span> tr, <span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (l &lt;= tl &amp;&amp; r &gt;= tr) &#123;</span><br><span class="line">    <span class="keyword">return</span> tree[rt];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> tm = (tl + tr) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  ll tmp = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (l &lt;= tm) &#123;</span><br><span class="line">    tmp += query(l, r, tl, tm, rt &lt;&lt; <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (r &gt; tm) &#123;</span><br><span class="line">    tmp += query(l, r, tm + <span class="number">1</span>, tr, rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">ff</span><span class="params">(ll x, ll y)</span> </span>&#123;</span><br><span class="line">  x = n - x + <span class="number">1</span>;</span><br><span class="line">  y = n - y + <span class="number">1</span>;</span><br><span class="line">  ll r = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (x &lt;= y &amp; x + y &lt;= n + <span class="number">1</span>) &#123;</span><br><span class="line">    r = x;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span> * (r - <span class="number">1</span>) * n - <span class="number">4</span> * (r - <span class="number">1</span>) * (r - <span class="number">1</span>) + <span class="number">1</span> + y - r;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (x &lt;= y &amp; x + y &gt;= n + <span class="number">1</span>) &#123;</span><br><span class="line">    r = n - y + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span> * (r - <span class="number">1</span>) * n - <span class="number">4</span> * (r - <span class="number">1</span>) * (r - <span class="number">1</span>) + <span class="number">1</span> + n - <span class="number">2</span> * r + <span class="number">1</span> + x - r;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (x &gt;= y &amp; x + y &gt;= n + <span class="number">1</span>) &#123;</span><br><span class="line">    r = n - x + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span> * (r - <span class="number">1</span>) * n - <span class="number">4</span> * (r - <span class="number">1</span>) * (r - <span class="number">1</span>) + <span class="number">1</span> + <span class="number">3</span> * n - <span class="number">6</span> * r + <span class="number">3</span> - y +</span><br><span class="line">           r;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (x &gt;= y &amp; x + y &lt;= n + <span class="number">1</span>) &#123;</span><br><span class="line">    r = y;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span> * (r - <span class="number">1</span>) * n - <span class="number">4</span> * (r - <span class="number">1</span>) * (r - <span class="number">1</span>) + <span class="number">1</span> + <span class="number">4</span> * n - <span class="number">8</span> * r + <span class="number">4</span> - x +</span><br><span class="line">           r;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">f</span><span class="params">(ll x, ll y)</span> </span>&#123;</span><br><span class="line">  ll ans = ff(x, y);</span><br><span class="line">  ll sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (ans) &#123;</span><br><span class="line">    sum += ans % <span class="number">10</span>;</span><br><span class="line">    ans /= <span class="number">10</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> T;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">  <span class="keyword">while</span> (T--) &#123;</span><br><span class="line">    <span class="built_in">memset</span>(tree, <span class="number">0</span>, <span class="keyword">sizeof</span>(tree));</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;m, &amp;q);</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;p[tot].x, &amp;p[tot].y);</span><br><span class="line">      p[tot++].tag = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; q; i++) &#123;</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;p[tot].x, &amp;p[tot].y);</span><br><span class="line">      p[tot].id = p[tot + <span class="number">1</span>].id = i;</span><br><span class="line">      p[tot++].tag = <span class="number">0</span>;</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;p[tot].x, &amp;p[tot].y);</span><br><span class="line">      p[tot - <span class="number">1</span>].x1 = p[tot].x;</span><br><span class="line">      p[tot].x1 = p[tot - <span class="number">1</span>].x;</span><br><span class="line">      p[tot++].tag = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(p, p + tot);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tot; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (p[i].tag == <span class="number">1</span>) &#123;</span><br><span class="line">        update(<span class="number">1</span>, n, <span class="number">1</span>, p[i].x, f(p[i].x, p[i].y));</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p[i].tag == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> id = p[i].id;</span><br><span class="line">        ans[id] = query(p[i].x, p[i].x1, <span class="number">1</span>, n, <span class="number">1</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> id = p[i].id;</span><br><span class="line">        ans[id] = query(p[i].x1, p[i].x, <span class="number">1</span>, n, <span class="number">1</span>) - ans[id];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; q; i++) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<p>9.3更新</p>
<h3 id="代码2"><a href="#代码2" class="headerlink" title="代码2"></a>代码2</h3><p>补上一个用主席树写的版本，在线查询，不用离线……</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> lch, rch, sum;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">point</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> x, y;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> point&amp; t) <span class="keyword">const</span> &#123; <span class="keyword">return</span> y &lt; t.y; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">node tree[maxn * <span class="number">40</span>];</span><br><span class="line">point p[maxn];</span><br><span class="line"><span class="keyword">int</span> root[maxn];</span><br><span class="line"><span class="keyword">int</span> tot;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span>&amp; rt)</span> </span>&#123;</span><br><span class="line">  rt = tot++;</span><br><span class="line">  tree[rt].sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  build(l, m, tree[rt].lch);</span><br><span class="line">  build(m + <span class="number">1</span>, r, tree[rt].rch);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span>&amp; rt, <span class="keyword">int</span> pre, <span class="keyword">int</span> c, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">  rt = tot++;</span><br><span class="line">  tree[rt] = tree[pre];</span><br><span class="line">  tree[rt].sum += val;</span><br><span class="line">  <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (c &lt;= m) &#123;</span><br><span class="line">    update(l, m, tree[rt].lch, tree[pre].lch, c, val);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    update(m + <span class="number">1</span>, r, tree[rt].rch, tree[pre].rch, c, val);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> tl, <span class="keyword">int</span> tr, <span class="keyword">int</span> rt, <span class="keyword">int</span> pre, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (l &lt;= tl &amp;&amp; r &gt;= tr) &#123;</span><br><span class="line">    <span class="keyword">return</span> tree[rt].sum - tree[pre].sum;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> tm = (tl + tr) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (l &lt;= tm) &#123;</span><br><span class="line">    sum += query(tl, tm, tree[rt].lch, tree[pre].lch, l, r);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (r &gt; tm) &#123;</span><br><span class="line">    sum += query(tm + <span class="number">1</span>, tr, tree[rt].rch, tree[pre].rch, l, r);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">ff</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">  x = n - x + <span class="number">1</span>;</span><br><span class="line">  y = n - y + <span class="number">1</span>;</span><br><span class="line">  ll r = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (x &lt;= y &amp; x + y &lt;= n + <span class="number">1</span>) &#123;</span><br><span class="line">    r = x;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span> * (r - <span class="number">1</span>) * n - <span class="number">4</span> * (r - <span class="number">1</span>) * (r - <span class="number">1</span>) + <span class="number">1</span> + y - r;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (x &lt;= y &amp; x + y &gt;= n + <span class="number">1</span>) &#123;</span><br><span class="line">    r = n - y + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span> * (r - <span class="number">1</span>) * n - <span class="number">4</span> * (r - <span class="number">1</span>) * (r - <span class="number">1</span>) + <span class="number">1</span> + n - <span class="number">2</span> * r + <span class="number">1</span> + x - r;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (x &gt;= y &amp; x + y &gt;= n + <span class="number">1</span>) &#123;</span><br><span class="line">    r = n - x + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span> * (r - <span class="number">1</span>) * n - <span class="number">4</span> * (r - <span class="number">1</span>) * (r - <span class="number">1</span>) + <span class="number">1</span> + <span class="number">3</span> * n - <span class="number">6</span> * r + <span class="number">3</span> - y +</span><br><span class="line">           r;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (x &gt;= y &amp; x + y &lt;= n + <span class="number">1</span>) &#123;</span><br><span class="line">    r = y;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span> * (r - <span class="number">1</span>) * n - <span class="number">4</span> * (r - <span class="number">1</span>) * (r - <span class="number">1</span>) + <span class="number">1</span> + <span class="number">4</span> * n - <span class="number">8</span> * r + <span class="number">4</span> - x +</span><br><span class="line">           r;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">  ll ans = ff(x, y);</span><br><span class="line">  ll sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (ans) &#123;</span><br><span class="line">    sum += ans % <span class="number">10</span>;</span><br><span class="line">    ans /= <span class="number">10</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> T;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">  <span class="keyword">while</span> (T--) &#123;</span><br><span class="line">    <span class="keyword">int</span> m, q;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;m, &amp;q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;p[i].x, &amp;p[i].y);</span><br><span class="line">    &#125;</span><br><span class="line">    sort(p + <span class="number">1</span>, p + m + <span class="number">1</span>);</span><br><span class="line">    build(<span class="number">1</span>, n, root[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">      update(<span class="number">1</span>, n, root[i], root[i - <span class="number">1</span>], p[i].x, f(p[i].x, p[i].y));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">      point p1, p2;</span><br><span class="line">      <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>, &amp;p1.x, &amp;p1.y, &amp;p2.x, &amp;p2.y);</span><br><span class="line">      <span class="keyword">int</span> t1 = lower_bound(p + <span class="number">1</span>, p + m + <span class="number">1</span>, p1) - p - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">int</span> t2 = upper_bound(p + <span class="number">1</span>, p + m + <span class="number">1</span>, p2) - p - <span class="number">1</span>;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, query(<span class="number">1</span>, n, root[t2], root[t1], p1.x, p2.x));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">zzpw</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://zzpw.github.io/2019/09/02/%E5%8D%97%E4%BA%AC%E7%BD%91%E7%BB%9C%E8%B5%9B-A/">http://zzpw.github.io/2019/09/02/%E5%8D%97%E4%BA%AC%E7%BD%91%E7%BB%9C%E8%B5%9B-A/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://zzpw.github.io" target="_blank">zzpw's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%80%9D%E7%BB%B4/">思维</a><a class="post-meta__tags" href="/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/">线段树</a></div><div class="post_share"><div class="social-share" data-image="https://wallpapershome.com/images/pages/pic_h/16580.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/09/03/P3834-%E5%8C%BA%E9%97%B4%E7%AC%AC-K-%E5%A4%A7/"><img class="prev-cover" src="https://wallpapershome.com/images/pages/pic_h/16579.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">P3834 区间第 K 大</div></div></a></div><div class="next-post pull-right"><a href="/2019/08/28/Isomorphic-Inversion/"><img class="next-cover" src="https://wallpapershome.com/images/pages/pic_h/16769.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Isomorphic Inversion</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2019/08/12/2019-HDUMul-7-Final-Exam/" title="2019杭电多校7 1006-Final Exam"><img class="cover" src="https://wallpapershome.com/images/pages/pic_h/14525.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-08-12</div><div class="title">2019杭电多校7 1006-Final Exam</div></div></a></div><div><a href="/2019/09/07/徐州网络赛-I/" title="徐州网络赛 I"><img class="cover" src="https://wallpapershome.com/images/pages/pic_h/16578.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-07</div><div class="title">徐州网络赛 I</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/zzpw.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">zzpw</div><div class="author-info__description">做正确与合适的事</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/zzpw"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/zzpw" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:zengpengwu@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://zhihu.com/people/ceng-peng-wu" target="_blank" title="Zhihu"><i class="fab fa-zhihu"></i></a></div></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">具体事宜可以在留言区或者邮箱联系博主。</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#The-beautiful-values-of-the-palace"><span class="toc-number">1.</span> <span class="toc-text">The beautiful values of the palace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Input"><span class="toc-number">2.</span> <span class="toc-text">Input</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Output"><span class="toc-number">3.</span> <span class="toc-text">Output</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B7%E4%BE%8B%E8%BE%93%E5%85%A5"><span class="toc-number">4.</span> <span class="toc-text">样例输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B7%E4%BE%8B%E8%BE%93%E5%87%BA"><span class="toc-number">5.</span> <span class="toc-text">样例输出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E6%84%8F"><span class="toc-number">6.</span> <span class="toc-text">题意</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">7.</span> <span class="toc-text">解决方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">8.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%812"><span class="toc-number">9.</span> <span class="toc-text">代码2</span></a></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2020/12/22/%E6%97%B6%E9%9A%94%E4%B8%80%E5%B9%B4%E5%A4%9A/" title="时隔一年多"><img src="https://wallpapershome.com/images/pages/pic_h/17188.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="时隔一年多"/></a><div class="content"><a class="title" href="/2020/12/22/%E6%97%B6%E9%9A%94%E4%B8%80%E5%B9%B4%E5%A4%9A/" title="时隔一年多">时隔一年多</a><time datetime="2020-12-22T13:26:18.000Z" title="发表于 2020-12-22 21:26:18">2020-12-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/03/23/%E5%85%AC%E7%BD%91%E8%BF%9E%E6%8E%A5%E9%98%BF%E9%87%8C%E4%BA%91ecs%E4%B8%8A%E7%9A%84mongodb/" title="公网连接阿里云ecs上的mongodb"><img src="https://wallpapershome.com/images/pages/pic_h/17190.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="公网连接阿里云ecs上的mongodb"/></a><div class="content"><a class="title" href="/2020/03/23/%E5%85%AC%E7%BD%91%E8%BF%9E%E6%8E%A5%E9%98%BF%E9%87%8C%E4%BA%91ecs%E4%B8%8A%E7%9A%84mongodb/" title="公网连接阿里云ecs上的mongodb">公网连接阿里云ecs上的mongodb</a><time datetime="2020-03-23T08:35:20.000Z" title="发表于 2020-03-23 16:35:20">2020-03-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/01/19/Chrome%E9%A1%B5%E9%9D%A2-%E5%96%94%E5%94%B7%E5%B4%A9%E6%BA%83%E4%BA%86-%E9%97%AE%E9%A2%98/" title="Chrome页面 喔唷崩溃了 问题"><img src="https://wallpapershome.com/images/pages/pic_h/17192.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Chrome页面 喔唷崩溃了 问题"/></a><div class="content"><a class="title" href="/2020/01/19/Chrome%E9%A1%B5%E9%9D%A2-%E5%96%94%E5%94%B7%E5%B4%A9%E6%BA%83%E4%BA%86-%E9%97%AE%E9%A2%98/" title="Chrome页面 喔唷崩溃了 问题">Chrome页面 喔唷崩溃了 问题</a><time datetime="2020-01-19T14:41:47.000Z" title="发表于 2020-01-19 22:41:47">2020-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2019/11/20/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%A8%A1%E6%8B%9Frip%E5%8D%8F%E8%AE%AE/" title="java多线程模拟rip协议"><img src="https://wallpapershome.com/images/pages/pic_h/16515.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="java多线程模拟rip协议"/></a><div class="content"><a class="title" href="/2019/11/20/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%A8%A1%E6%8B%9Frip%E5%8D%8F%E8%AE%AE/" title="java多线程模拟rip协议">java多线程模拟rip协议</a><time datetime="2019-11-20T02:51:59.000Z" title="发表于 2019-11-20 10:51:59">2019-11-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2019/11/11/%E7%BB%93%E6%9D%9F%E4%B8%8E%E6%96%B0%E7%9A%84%E5%BC%80%E5%A7%8B/" title="结束与新的开始"><img src="https://wallpapershome.com/images/pages/pic_h/16519.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="结束与新的开始"/></a><div class="content"><a class="title" href="/2019/11/11/%E7%BB%93%E6%9D%9F%E4%B8%8E%E6%96%B0%E7%9A%84%E5%BC%80%E5%A7%8B/" title="结束与新的开始">结束与新的开始</a><time datetime="2019-11-11T08:48:22.000Z" title="发表于 2019-11-11 16:48:22">2019-11-11</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 By zzpw</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Welocome to zzpw's blog</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    loader: {
      source: {
        '[tex]/amsCd': '[tex]/amscd'
      }
    },
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        addClass: [200,() => {
          document.querySelectorAll('mjx-container:not([display=\'true\']').forEach( node => {
            const target = node.parentNode
            if (!target.classList.contains('has-jax')) {
              target.classList.add('mathjax-overflow')
            }
          })
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: 'dvBFzl6apeBQrxxFy0tLkaHI-gzGzoHsz',
      appKey: 't8yipQInK9apLY7n2aEeQgBe',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: true,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
    }

    if (false) { 
      initData.requiredFields= (''.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign({}, initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script>(function(){
  const bp = document.createElement('script');
  const curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  bp.dataset.pjax = ''
  const s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})()</script></div></body></html>